TripTrip 酒店管理与预订系统项目复现指南（PC + 后端 + 微信小程序）
1. 项目概述

triptrip 是一个包含 PC 管理端 + 后端 API + 微信小程序移动端（Taro） 的酒店管理与预订系统项目。仓库当前结构中，根目录是 PC 管理端（React + Vite），backend/ 是 Express + MongoDB 后端，mobile/ 是 Taro React 微信小程序工程。

项目目前已包含公开酒店接口（如 /api/public/hotels/...）以及移动端页面配置（首页、列表、详情、订单确认页）。

2. 系统要求
2.1 基础环境

操作系统：Windows 10/11、macOS、Linux

Node.js：建议 v18+（项目依赖较新；最低可先按 Node 16 尝试）

npm：随 Node.js 安装

Git：用于克隆仓库

MongoDB：建议本地安装 MongoDB Community（或使用 MongoDB Atlas）

2.2 微信小程序开发（移动端）

微信开发者工具（用于运行 mobile 小程序）

建议具备一个可用的小程序测试 AppID（仓库中 mobile/project.config.json 已有一个 appid 字段，但复现时建议替换为你自己的测试号/体验号 AppID）。miniprogramRoot 配置为 dist/。

3. 项目结构（按当前仓库）

下面是你这个项目（triptrip）的核心结构说明（非完全展开）。

triptrip/
├── backend/                  # Node.js + Express + MongoDB 后端
│   ├── config/              # 数据库配置（如 db.js）
│   ├── models/              # User / Hotel / Order 等模型
│   ├── routes/              # auth / hotels / public-hotels / publicOrders(已存在文件)
│   ├── middleware/          # 错误处理等中间件
│   └── server.js            # 后端入口
│
├── mobile/                  # Taro 微信小程序项目
│   ├── config/              # Taro 配置
│   ├── src/
│   │   ├── api/             # 小程序请求封装（Taro.request）
│   │   └── pages/           # 页面（home / hotel-list / hotel-detail / order-confirm）
│   ├── project.config.json  # 微信开发者工具项目配置（miniprogramRoot=dist）
│   └── package.json         # Taro 构建脚本
│
├── public/                  # PC 管理端静态资源（根目录）
├── src/                     # PC 管理端源码（React + Vite）
├── package.json             # PC 管理端 package.json（根目录）
├── API文档.md
├── compass-connections.json
└── README.md / 项目复现指南.md

仓库首页可见根目录含 backend、mobile、public、src 等目录；mobile/src/app.config.ts 中已配置 4 个页面路由（首页、列表、详情、订单确认）。

4. 环境搭建
4.1 安装 Node.js

前往 Node.js 官网下载安装 LTS 版本（建议 Node 18 或更高）。

安装后验证：

node -v
npm -v
4.2 安装 MongoDB（本地）

你可以按系统选择安装方式（Windows / macOS / Linux）。安装完成后，确认数据库服务可运行。

常见验证方式：

mongosh

如果能进入 Mongo Shell，说明基本正常。

4.3 安装微信开发者工具（移动端需要）

安装微信开发者工具（Windows/macOS）

登录微信开发者账号

后续会用它打开 triptrip/mobile 工程（读取 project.config.json），小程序编译输出目录为 dist/。

5. 克隆项目与安装依赖
5.1 克隆仓库
git clone https://github.com/cmyongnian/triptrip.git
cd triptrip

仓库当前为公开仓库（Public）。

5.2 安装根目录依赖（PC 管理端）

根目录 package.json 是 Vite + React 的 PC 管理端工程，脚本包含 dev/build/preview。

npm install
5.3 安装后端依赖

backend/package.json 提供 start 与 dev (nodemon) 脚本。

cd backend
npm install
cd ..
5.4 安装移动端依赖（Taro 小程序）

mobile/package.json 提供 dev:weapp / build:weapp 等脚本。

cd mobile
npm install
cd ..
6. 配置环境变量（后端）
6.1 创建 backend/.env

在 triptrip/backend/ 目录下创建 .env 文件，建议内容如下：

# 服务器端口
PORT=5000

# MongoDB 连接串（二选一即可，代码同时兼容）
MONGODB_URI=mongodb://127.0.0.1:27017/triptrip
# MONGO_URI=mongodb://127.0.0.1:27017/triptrip

# JWT 密钥（生产环境请务必替换）
JWT_SECRET=change_this_to_a_strong_secret

后端 config/db.js 会优先读取 MONGODB_URI，其次读取 MONGO_URI；如果都没配置会抛出缺失连接串错误。

6.2 关于数据库数据

项目仓库中有 compass-connections.json，你可以用 MongoDB Compass 导入连接配置。仓库首页也列出了该文件。

如果你没有现成数据，至少需要保证：

可以注册用户（User）

能创建酒店（Hotel）

若要走移动端下单流程，后续会用到 Order 模型（仓库已包含 Order.js）。

7. 运行项目（推荐启动顺序）
7.1 启动后端（必须先启动）
cd backend
npm run dev

或：

npm start

后端入口是 backend/server.js，默认端口读取 PORT，未配置时使用 5000。

你通常会看到类似日志：

Server running on port 5000
MongoDB connected successfully

如果 MongoDB 未连接成功，当前后端代码会打印连接失败日志，但服务器进程可能仍然启动（接口会返回数据库错误）。

7.2 启动 PC 管理端（根目录）

新开一个终端窗口，在项目根目录执行：

npm run dev

根目录脚本是 Vite，默认会启动本地开发服务器（通常为 5173 端口）。

访问（通常）：

http://localhost:5173
7.3 启动移动端（Taro 微信小程序）

再开一个终端，进入 mobile 目录：

cd mobile
npm run dev:weapp

这个命令会持续监听并输出到 mobile/dist/（Taro 配置 outputRoot: 'dist'，微信开发者工具项目配置的 miniprogramRoot 也是 dist/）。

7.4 用微信开发者工具打开小程序工程

打开微信开发者工具

导入项目：选择 triptrip/mobile

确认项目配置读取到 project.config.json

若提示 AppID 问题，可替换为你自己的测试号 AppID（建议）

8. 微信小程序运行关键配置（你这个项目非常重要）

你前面遇到的“微信小程序页面无法加载 / 数据不出来”，通常不是页面路由问题，而是 小程序无法请求本地后端。

8.1 勾选微信开发者工具调试项（本地开发必做）

在微信开发者工具里打开 详情，勾选：

✅ 不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书

否则 http://...:5000 这类本地接口经常会被拦截。

8.2 修改 mobile/src/api/index.ts 的接口地址（核心）

仓库当前 mobile/src/api/index.ts 默认 BASE_URL 使用 http://localhost:5000/api（无论 H5 还是小程序默认返回 localhost），这在微信小程序环境下往往会导致请求失败。

推荐做法（本地调试）

H5：可以继续用 localhost

微信小程序：改成 你电脑的局域网 IP（如 192.168.31.25）

示例（你可按之前已改过的版本继续用）：

// 小程序环境使用局域网 IP，而不是 localhost
const LAN_IP = '192.168.31.25'

然后让小程序端 BASE_URL 走：

http://${LAN_IP}:5000/api

提示：Windows 下用 ipconfig 查 IPv4 地址。

8.3 每次修改后都要重新编译

在 mobile 目录保持：

npm run dev:weapp

然后在微信开发者工具中执行：

清缓存

重新编译

否则工具里可能看到旧的 dist 输出。